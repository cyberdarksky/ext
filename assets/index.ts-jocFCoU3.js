import{m as f,k as m,T as y,M as X,b as Pe,A as Me,I as Oe,h as Ae,g as De,C as Fe,w as Z,y as Le,a as Ne,u as je,p as Q,d as ee,P as te}from"./index-C76mI2PX.js";import{y as pe,p as A,c as xe,S as z,g as Re}from"./onMessage-Bv5gN1bZ.js";import{p as I,h as E,e as Ue}from"./const-wL6z_72Y.js";function Be(e){const{hostMatch:t,extensionId:n,extensionName:r}=e;chrome.tabs.onUpdated.addListener(async(a,s,o)=>{if(o&&o.url&&o&&o.url&&s&&s.status==="loading"){const l=new URL(o.url).hostname;if(t.find(c=>!!~c.indexOf(l))){const c=chrome.runtime.getManifest();chrome.scripting.executeScript({injectImmediately:!0,world:"MAIN",target:{tabId:a,allFrames:!0},func:g=>{window[g.slug]=g},args:[{id:chrome.runtime.id,slug:n,extensionName:r,version:c.version,icons:c.icons,extensionFolderUri:chrome.runtime.getURL("/"),isProdMode:"update_url"in chrome.runtime.getManifest()}]})}}})}var ge=(e=>(e[e.FREE=0]="FREE",e[e.BASIC=1]="BASIC",e[e.PREMIUM=2]="PREMIUM",e))(ge||{});const $e={type:"object",properties:{uid:{type:"string",default:""},email:{type:"string",default:""},stripeId:{type:"string",default:""},name:{type:"string",default:""},payments:{type:"array",items:{type:"object",properties:{},required:[],default:{}},default:[]},plan:{type:"string",default:ge.FREE},isSubscriptionActive:{type:"boolean",default:!1},lastCheckAt:{type:"number",default:0}},required:["uid","email","stripeId","name","payments","plan","isSubscriptionActive","lastCheckAt"],default:{}},ke={type:"object",properties:{},required:[],default:{}},He={type:"object",properties:{},required:[],default:{}},j={customerDataV2:$e,features:ke,persistLocalStorage:He};function ye(){return Math.floor(new Date().getTime()/1e3)}function ne(e){return e+86400<ye()}async function Ke(e){const t=await chrome.tabs.query({url:e.filter(n=>!~n.indexOf("esuit"))});for(let n of t)n.id&&await chrome.tabs.reload(n.id)}let D=[];const{updateBucket:re,getBucket:B,deleteBucket:ae}=A(j);function qe(e){f("logout",async()=>{await ae("customerDataV2"),await ae("features")}),f("login",async()=>{const t=new URLSearchParams({[X.RETURN_EXT_LOCAL]:chrome.runtime.id}).toString();await chrome.tabs.create({url:`https://esuit.dev/login?${t}`,active:!0})}),f("closePopup",async()=>{chrome.extension.getViews({type:"popup"}).forEach(t=>{t.window.close()})}),f("openOptionsPage",async t=>{const n=chrome.runtime.getURL("src/pages/options/index.html"+(t?"#showSubscription=1":""));(await chrome.tabs.query({url:[n]})).forEach(r=>(r==null?void 0:r.id)&&chrome.tabs.remove(r.id)),await new Promise(r=>setTimeout(r,300)),await chrome.tabs.create({url:n,active:!0})}),f("getCustomerData",async()=>{const t=await B("customerDataV2");if(t.uid)return ne(t.lastCheckAt)&&m("reFetchCustomerData"),t}),f("reFetchCustomerData",async(t=!1)=>{const n=await B("customerDataV2"),r=n.uid;if(!r)return!1;if(!t&&r&&!ne(n.lastCheckAt))return!0;let a=null,s=null;try{const[c,g]=await Promise.all([fetch(`https://getusersubscription-57pphaecyq-uc.a.run.app/?token=${Pe(r,e.projectId)}`).then(p=>p.json()),ze()]);if(c.stripeId&&(a=c),g){const p=g.find(i=>i.projectId===e.projectId);p&&(s=p)}}catch(c){return console.error(c),"Unknown error, please contact the developer."}if(!a||!s)return"ERROR: reFetchCustomerData returned undefined";let o=a.allPayments.filter(c=>Me(c.status)||Oe(c.status)||Ae(c.status)||De(c.status)||Fe(c.status)),l=y.FREE;return se(o,s,y.BASIC)&&(l=y.BASIC),se(o,s,y.PREMIUM)&&(l=y.PREMIUM),await re("customerDataV2",async c=>a?{uid:r,stripeId:a.stripeId,email:a.email,name:a.name,payments:a.allPayments,plan:l,isSubscriptionActive:l!==y.FREE,lastCheckAt:ye()}:c),m("rejectFeaturesToWindow"),!0}),f("visitPricingPage",async()=>{const t=`https://esuit.dev/pricing/${e.projectId}`,n=new URLSearchParams({[X.RETURN_EXT_LOCAL]:chrome.runtime.id}).toString();await chrome.tabs.create({url:t+`?${n}`,active:!0})}),f("visitDashboard",async()=>{await chrome.tabs.create({url:"https://esuit.dev/dashboard",active:!0}),m("closePopup")}),Z("ifUserLogin",async()=>!!(await B("customerDataV2")).uid),Z("userInfoUpdate",async([t])=>{t&&(await re("customerDataV2",n=>(n.uid=t,n)),await m("reFetchCustomerData",!0),m("openOptionsPage",!0),setTimeout(()=>{Ke(e.hostMatch)},2e3))})}async function ze(){if(D.length>0)return D;const e=await fetch("https://static-data.esuit.dev/index.json").then(t=>t.json());return D=Le(e),D}function se(e,t,n){return!!e.find(r=>{if(![...Ne,...je,...Q,...ee,...te].includes(r.status)||[...Q].includes(r.status)&&(!r.nextBillingDate||r.nextBillingDate<Math.ceil(new Date().getTime()/1e3))||[...ee].includes(r.status)&&(!r.nextBillingDate||r.nextBillingDate<Math.ceil(new Date().getTime()/1e3))||[...te].includes(r.status)&&(!r.nextBillingDate||r.nextBillingDate<Math.ceil(new Date().getTime()/1e3)))return!1;const a=t.prices.find(s=>s.id===r.priceId);return!(!a||a.plan!==n)})}var Ve=Object.defineProperty,Ge=(e,t,n)=>t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,F=(e,t,n)=>(Ge(e,typeof t!="symbol"?t+"":t,n),n);class V{constructor(t,n){F(this,"listeners",{}),F(this,"tabs",[]),F(this,"slug"),F(this,"isDebugger"),this.slug=t,this.isDebugger=!!n,this.bindMessage(),this.bindEvent()}on(t,n){if(this.listeners[t])throw new Error(`event listener ${String(t)} already exist!`);return this.listeners[t]=n,()=>{delete this.listeners[t]}}async send(t,...n){this.isDebugger&&console.log("send message from background script",{action:t,payload:n,tabs:this.tabs});for(let r of this.tabs)try{const a=await chrome.tabs.get(r);a&&a.id?chrome.tabs.sendMessage(a.id,{from:this.slug,payload:{action:t,payload:n}}):this.deleteTabById(r)}catch(a){console.log(a),this.deleteTabById(r)}}bindMessage(){chrome.runtime.onMessageExternal.addListener((t,n,r)=>{var a,s;if((a=n==null?void 0:n.tab)!=null&&a.id){if(this.isDebugger&&console.log("received message from page",{request:t,sender:n}),t.action==="__connect")return this.tabs.includes(n.tab.id)||this.tabs.push(n.tab.id),r();if(t.action==="__disconnect")return this.deleteTabById(n.tab.id),r();if(this.listeners[t.action])return(s=n==null?void 0:n.tab)!=null&&s.id?(this.tabs.includes(n.tab.id)||this.tabs.push(n.tab.id),this.listeners[t.action](...t.payload).then(o=>{this.isDebugger&&console.log("send to callback from background",{request:t,sender:n,res:o}),r(o)}),!0):r();console.log(`unknown event ${t.action}`)}})}bindEvent(){chrome.tabs.onRemoved.addListener(t=>{this.deleteTabById(t)})}deleteTabById(t){if(this.tabs.includes(t)){const n=this.tabs.indexOf(t);this.tabs.splice(n,1)}}}function Ye(e){return[y.FREE,y.BASIC,y.PREMIUM].indexOf(e)}function Je(e,t){const n=Ye(t);return e.limitation?e.limitation[n]:0}function ie(e,t){return{[y.FREE]:1,[y.BASIC]:10,[y.PREMIUM]:100}[t]>=e.permission}function $(e,t){return e.map(n=>{t[n.key]?(t[n.key].enable=t[n.key].enable??n.defaultEnable,t[n.key].currentFreeTryCount=t[n.key].currentFreeTryCount??0):t[n.key]={enable:n.defaultEnable,currentFreeTryCount:0}}),t}function We(e){const{cacheId:t,defaultMemoConfig:n}=e;f("setUIMemoSettings",async r=>{await chrome.storage.local.set({[t]:r})}),f("getUIMemoSettings",async()=>{const r=await m("getFeaturesDataByPlan");let a=await new Promise(s=>{chrome.storage.local.get([t]).then(o=>{o[t]?s(o[t]):s(!1)})});return a||(a={...n}),Object.keys(a).map(s=>{const o=Object.values(r).find(c=>c._.memoKey===s);if(o&&o.needUpgrade&&(!o.enable||!(o.freeTryLeft>0||o.limitation>0)&&n[s]!==void 0))return l();function l(){a[s]=n[s]}}),{...n,...a}})}let be=!1;function Xe(){return be}function Ze(){be=!0}const{updateBucket:k,getBucket:oe}=A(j);function Qe(e){if(Xe())return;Ze();const t=new V(e,!0);return f("getAllPersistLocalStorage",()=>oe("persistLocalStorage")),f("setPersistLocalStorage",async(n,r)=>{await k("persistLocalStorage",a=>{try{r=JSON.stringify(r)}catch{}return a[n]=r,a})}),f("getPersistLocalStorage",async(n,r)=>{const a=await oe("persistLocalStorage");if(a[n]){try{return JSON.parse(a[n])}catch{}return a[n]}return r??void 0}),f("clearPersistLocalStorage",async()=>{k("persistLocalStorage",()=>({}))}),f("removePersistLocalStorage",async n=>{k("persistLocalStorage",r=>(delete r[n],r))}),t.on("getAllPersistLocalStorage",()=>m("getAllPersistLocalStorage")),t.on("setPersistLocalStorage",(...n)=>m("setPersistLocalStorage",...n)),t.on("getPersistLocalStorage",(...n)=>m("getPersistLocalStorage",...n)),t.on("clearPersistLocalStorage",()=>m("clearPersistLocalStorage")),void t.on("removePersistLocalStorage",n=>m("removePersistLocalStorage",n))}const{setBucket:ce,getBucket:H}=A(j);function et(e){const{projectId:t,hostMatch:n,cacheId:r,features:a,defaultMemoConfig:s}=e,o=new V(t,!0);return Qe(e.projectId),We({cacheId:r,defaultMemoConfig:s}),chrome.tabs.onUpdated.addListener(async(i,d,u)=>{if(u&&u.url&&d.status==="loading"){const h=new URL(u.url).hostname;n.find(_=>!!~_.indexOf(h))&&c(i)}}),chrome.storage.onChanged.addListener((i,d)=>{d==="local"&&i&&i.features&&l()}),f("rejectFeaturesToWindow",async()=>{l()}),f("getFeature",async i=>g()[i]),f("consumeFeaturesTreeTryByMemoUIConfigs",async i=>{const d=await g();let u=[];Object.entries(i).map(([h,_])=>{if(s[h]!==void 0&&s[h]!==_){const b=Object.values(d).find(C=>C._.memoKey===h);b&&b.isCanFreeTry&&u.push(b._.key)}}),u.length>0&&m("consumeFeatureTreeTry",u)}),f("consumeFeatureTreeTry",async i=>{let d=$(a,await H("features"));const u=await p();let h=!1;i.map(_=>{const b=a.find(C=>C.key===_||C.memoKey===_);b&&(ie(b,u)||(d[b.key].currentFreeTryCount++,h=!0))}),h&&await ce("features",d)}),f("saveFeaturesEnables",async i=>{let d=$(a,await H("features"));Object.entries(i).map(([u,h])=>{d[u].enable=h}),await ce("features",d)}),f("getFeaturesDataByPlan",g),o.on("getUIMemoSettings",()=>m("getUIMemoSettings")),o.on("setUIMemoSettings",i=>m("setUIMemoSettings",i)),o.on("consumeFeatureTreeTry",i=>m("consumeFeatureTreeTry",i)),o.on("visitPricingPage",()=>m("visitPricingPage")),void o.on("consumeFeaturesTreeTryByMemoUIConfigs",i=>{m("consumeFeaturesTreeTryByMemoUIConfigs",i)});async function l(){const i=await chrome.tabs.query({url:n});i&&i.map(d=>{d&&d.id&&c(d.id)})}async function c(i){const d=await g();chrome.scripting.executeScript({injectImmediately:!0,world:"MAIN",target:{tabId:i,allFrames:!0},func:(u,h)=>{window[h]=JSON.parse(u)},args:[JSON.stringify(d),`${t.replaceAll("-","_")}`]})}async function g(){const i=await p();let d=$(a,await H("features"));return a.map(u=>{var h;const _=ie(u,i);let b,C=0;return u.memoKey&&(b=s[u.memoKey]),u.maxFreeTryCount&&d[u.key].currentFreeTryCount!==void 0&&(C=Math.max(0,u.maxFreeTryCount-d[u.key].currentFreeTryCount)),{enable:((h=d[u.key])==null?void 0:h.enable)??u.defaultEnable,needUpgrade:!_,limitation:Je(u,i),permission:u.permission,freeTryLeft:u.maxFreeTryCount?C:0,isCanFreeTry:!!u.maxFreeTryCount&&u.maxFreeTryCount>0,defaultValue:b,_:u}}).reduce((u,h)=>(u[h._.key]=h,u),{})}async function p(){const i=await m("getCustomerData");return i?i.plan:y.FREE}}function tt(e,t){(async()=>{let n=0,r=(await chrome.declarativeNetRequest.getDynamicRules()).map(s=>s.id);const a=e.map((s,o)=>(n=o+1,{id:n,priority:1,action:{type:"modifyHeaders",responseHeaders:[{header:"Content-Security-Policy",operation:"remove"},{header:"Content-Security-Policy-Report-Only",operation:"remove"}]},condition:{regexFilter:s,resourceTypes:["main_frame","xmlhttprequest"]}}));await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:r,addRules:a})})()}function nt(e){const t=new V(e,!0);t.on("reFetchCustomerData",n=>m("reFetchCustomerData",n)),t.on("visitDashboard",()=>m("visitDashboard")),t.on("getCustomerData",()=>m("getCustomerData")),t.on("logout",()=>m("logout")),t.on("login",()=>m("login"))}function rt(e){pe(j),qe(e),nt(e.projectId)}var _e=(e=>(e[e.ALL=0]="ALL",e[e.BY_POST_COUNT=1]="BY_POST_COUNT",e[e.BY_DAYS_COUNT=2]="BY_DAYS_COUNT",e))(_e||{});const at=[{key:"FETCH_LIMIT",name:"Fetch Count limit",permission:1,limitation:[50,0,0],defaultEnable:!0,memoKey:null},{key:"INCLUDE_COMMENTS",name:"Including Comments",permission:10,limitation:[3,0,0],defaultEnable:!0,memoKey:"isExportComments"},{key:"INCLUDE_NESTING_COMMENTS",name:"Export Nesting Comments",permission:100,limitation:[3,3,0],defaultEnable:!0,memoKey:"isExportNestingComments"},{key:"SAVE_COMMENTS_AS_JSON_CSV_FILE",name:"Save Comments as JSON & CSV file",permission:10,limitation:[3,0,0],defaultEnable:!0,memoKey:"isSaveCommentsAsFile"},{key:"IS_DOWNLOAD_ATTACHMENTS_FROM_COMMENT",name:"Download attachments belong with the comment",permission:100,limitation:[3,3,0],defaultEnable:!0,memoKey:"isDownloadAttachmentsFromComment"},{key:"IS_DOWNLOAD_HD_ATTACHMENTS_FROM_COMMENT",name:"Download HD attachments belong with the comment",permission:100,defaultEnable:!0,memoKey:"isDownloadHDAttachmentsFromComment"},{key:"INCLUDE_ATTACHMENTS",name:"Including Attachments",permission:100,limitation:[3,3,0],defaultEnable:!0,memoKey:"isExportAttachments"},{key:"USE_DATE_FILTERS",name:"Posts Filter",permission:10,defaultEnable:!0,memoKey:null},{key:"TAKE_SCREENSHOT",name:"Take screenshot",permission:100,limitation:[3,3,0],defaultEnable:!0,memoKey:null},{key:"RESUME_DOWNLOADING",name:"Resume download",permission:10,defaultEnable:!0,memoKey:null},{key:"TRANSLATE_CONTENT",name:"Translate content",permission:100,defaultEnable:!0,limitation:[3,3,0],memoKey:"isTranslateContent"},{key:"HIDE_LOGO_ON_HTML_FILE",name:"Hide logo on HTML file",permission:100,defaultEnable:!1,memoKey:"isHideLogoInHTML"}],st={isExportComments:!1,isExportAttachments:!1,isExportNestingComments:!1,isSaveCommentsAsFile:!1,isTranslateContent:!1,isFullSpeed:!1,isGenHTMLFile:!1,isSavePostAsJSONFile:!1,isHideLogoInHTML:!1,isDownloadAttachmentsFromComment:!1,isDownloadHDAttachmentsFromComment:!1,exportCommentsLimit:50,fetchingCountType:_e.ALL,fetchingCountByPostCountValue:10,fetchingCountByPostDaysValue:3,requestDelay:0},w=new xe(I,!0);var it=typeof global=="object"&&global&&global.Object===Object&&global,ot=typeof self=="object"&&self&&self.Object===Object&&self,x=it||ot||Function("return this")(),v=x.Symbol,we=Object.prototype,ct=we.hasOwnProperty,ut=we.toString,M=v?v.toStringTag:void 0;function lt(e){var t=ct.call(e,M),n=e[M];try{e[M]=void 0;var r=!0}catch{}var a=ut.call(e);return r&&(t?e[M]=n:delete e[M]),a}var dt=Object.prototype,mt=dt.toString;function ft(e){return mt.call(e)}var ht="[object Null]",pt="[object Undefined]",ue=v?v.toStringTag:void 0;function Se(e){return e==null?e===void 0?pt:ht:ue&&ue in Object(e)?lt(e):ft(e)}function gt(e){return e!=null&&typeof e=="object"}var yt="[object Symbol]";function G(e){return typeof e=="symbol"||gt(e)&&Se(e)==yt}function bt(e,t){for(var n=-1,r=e==null?0:e.length,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a}var Y=Array.isArray,_t=1/0,le=v?v.prototype:void 0,de=le?le.toString:void 0;function Ce(e){if(typeof e=="string")return e;if(Y(e))return bt(e,Ce)+"";if(G(e))return de?de.call(e):"";var t=e+"";return t=="0"&&1/e==-_t?"-0":t}function Te(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var wt="[object AsyncFunction]",St="[object Function]",Ct="[object GeneratorFunction]",Tt="[object Proxy]";function vt(e){if(!Te(e))return!1;var t=Se(e);return t==St||t==Ct||t==wt||t==Tt}var K=x["__core-js_shared__"],me=function(){var e=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function It(e){return!!me&&me in e}var Et=Function.prototype,Pt=Et.toString;function Mt(e){if(e!=null){try{return Pt.call(e)}catch{}try{return e+""}catch{}}return""}var Ot=/[\\^$.*+?()[\]{}|]/g,At=/^\[object .+?Constructor\]$/,Dt=Function.prototype,Ft=Object.prototype,Lt=Dt.toString,Nt=Ft.hasOwnProperty,jt=RegExp("^"+Lt.call(Nt).replace(Ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function xt(e){if(!Te(e)||It(e))return!1;var t=vt(e)?jt:At;return t.test(Mt(e))}function Rt(e,t){return e==null?void 0:e[t]}function J(e,t){var n=Rt(e,t);return xt(n)?n:void 0}function Ut(){}function Bt(e,t,n,r){for(var a=e.length,s=n+-1;++s<a;)if(t(e[s],s,e))return s;return-1}function $t(e){return e!==e}function kt(e,t,n){for(var r=n-1,a=e.length;++r<a;)if(e[r]===t)return r;return-1}function Ht(e,t,n){return t===t?kt(e,t,n):Bt(e,$t,n)}function Kt(e,t){var n=e==null?0:e.length;return!!n&&Ht(e,t,0)>-1}function qt(e,t){return e===t||e!==e&&t!==t}var zt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Vt=/^\w*$/;function ve(e,t){if(Y(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||G(e)?!0:Vt.test(e)||!zt.test(e)||t!=null&&e in Object(t)}var O=J(Object,"create");function Gt(){this.__data__=O?O(null):{},this.size=0}function Yt(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Jt="__lodash_hash_undefined__",Wt=Object.prototype,Xt=Wt.hasOwnProperty;function Zt(e){var t=this.__data__;if(O){var n=t[e];return n===Jt?void 0:n}return Xt.call(t,e)?t[e]:void 0}var Qt=Object.prototype,en=Qt.hasOwnProperty;function tn(e){var t=this.__data__;return O?t[e]!==void 0:en.call(t,e)}var nn="__lodash_hash_undefined__";function rn(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=O&&t===void 0?nn:t,this}function T(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}T.prototype.clear=Gt;T.prototype.delete=Yt;T.prototype.get=Zt;T.prototype.has=tn;T.prototype.set=rn;function an(){this.__data__=[],this.size=0}function R(e,t){for(var n=e.length;n--;)if(qt(e[n][0],t))return n;return-1}var sn=Array.prototype,on=sn.splice;function cn(e){var t=this.__data__,n=R(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():on.call(t,n,1),--this.size,!0}function un(e){var t=this.__data__,n=R(t,e);return n<0?void 0:t[n][1]}function ln(e){return R(this.__data__,e)>-1}function dn(e,t){var n=this.__data__,r=R(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function P(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}P.prototype.clear=an;P.prototype.delete=cn;P.prototype.get=un;P.prototype.has=ln;P.prototype.set=dn;var mn=J(x,"Map");function fn(){this.size=0,this.__data__={hash:new T,map:new(mn||P),string:new T}}function hn(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function U(e,t){var n=e.__data__;return hn(t)?n[typeof t=="string"?"string":"hash"]:n.map}function pn(e){var t=U(this,e).delete(e);return this.size-=t?1:0,t}function gn(e){return U(this,e).get(e)}function yn(e){return U(this,e).has(e)}function bn(e,t){var n=U(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function S(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}S.prototype.clear=fn;S.prototype.delete=pn;S.prototype.get=gn;S.prototype.has=yn;S.prototype.set=bn;var _n="Expected a function";function W(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(_n);var n=function(){var r=arguments,a=t?t.apply(this,r):r[0],s=n.cache;if(s.has(a))return s.get(a);var o=e.apply(this,r);return n.cache=s.set(a,o)||s,o};return n.cache=new(W.Cache||S),n}W.Cache=S;var wn=500;function Sn(e){var t=W(e,function(r){return n.size===wn&&n.clear(),r}),n=t.cache;return t}var Cn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Tn=/\\(\\)?/g,vn=Sn(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Cn,function(n,r,a,s){t.push(a?s.replace(Tn,"$1"):r||n)}),t});function In(e){return e==null?"":Ce(e)}function En(e,t){return Y(e)?e:ve(e,t)?[e]:vn(In(e))}var Pn=1/0;function Ie(e){if(typeof e=="string"||G(e))return e;var t=e+"";return t=="0"&&1/e==-Pn?"-0":t}function Mn(e,t){t=En(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Ie(t[n++])];return n&&n==r?e:void 0}var q=J(x,"Set"),On="__lodash_hash_undefined__";function An(e){return this.__data__.set(e,On),this}function Dn(e){return this.__data__.has(e)}function N(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new S;++t<n;)this.add(e[t])}N.prototype.add=N.prototype.push=An;N.prototype.has=Dn;function Fn(e,t){return e.has(t)}function Ee(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}function Ln(e){return function(t){return t==null?void 0:t[e]}}function Nn(e){return function(t){return Mn(t,e)}}function jn(e){return ve(e)?Ln(Ie(e)):Nn(e)}function xn(e){return jn(e)}var Rn=1/0,Un=q&&1/Ee(new q([,-0]))[1]==Rn?function(e){return new q(e)}:Ut,Bn=200;function $n(e,t,n){var r=-1,a=Kt,s=e.length,o=!0,l=[],c=l;if(s>=Bn){var g=t?null:Un(e);if(g)return Ee(g);o=!1,a=Fn,c=new N}else c=t?[]:l;e:for(;++r<s;){var p=e[r],i=t?t(p):p;if(p=p!==0?p:0,o&&i===i){for(var d=c.length;d--;)if(c[d]===i)continue e;t&&c.push(i),l.push(p)}else a(c,i,n)||(c!==l&&c.push(i),l.push(p))}return l}function kn(e,t){return e&&e.length?$n(e,xn(t)):[]}const{updateBucket:Hn,setBucket:Jn,getBucket:Wn,deleteBucket:Xn}=A(z);function Kn(){w.on("addPostsToScreenshotArr",async e=>{await Hn("postsScreenshotArr",t=>{const n=t.find(r=>r.collectionId===e.collectionId);return n?(n.name=e.name,n.updateAt=e.updateAt,n.url=e.url,n.posts=kn([...e.posts,...n.posts],"postId")):t.push(e),t}),chrome.runtime.openOptionsPage()}),w.on("goScreenshotPage",()=>{chrome.runtime.openOptionsPage()})}const{updateBucket:fe,setBucket:Zn,getBucket:qn,deleteBucket:Qn}=A(z);let L=!0,he=0;function zn(){Kn(),w.on("setResumeCursors",async(e,t,n)=>{await fe("resumeCursors",r=>{r[e]=r[e]||{},r[e][t]=r[e][t]||{},r[e][t].cursor=n,r[e][t].timestamp=Re();const a=10,s=Object.entries(r[e]);if(s.length>a){s.sort((l,c)=>c[1].timestamp-l[1].timestamp);const o=s.slice(0,a).reduce((l,c)=>{const[g,p]=c;return l[g]=p,l},{});r[e]=o}return r})}),w.on("getResumeCursors",async e=>{const t=await qn("resumeCursors");return t[e]?t[e]:null}),w.on("removeResumeCursors",async(e,t)=>{await fe("resumeCursors",n=>(!n[e]||!n[e][t]||delete n[e][t],n))}),w.on("visitPricing",async()=>{m("visitPricingPage")}),w.on("downloadFileByUri",async(e,t,n)=>{L&&(await chrome.downloads.setUiOptions({enabled:!1}),L=!1);const r=await chrome.downloads.download({url:e,filename:t,conflictAction:"uniquify",saveAs:!1});n&&setTimeout(()=>chrome.downloads.show(r),600),clearTimeout(he),he=setTimeout(async()=>{L||(await chrome.downloads.setUiOptions({enabled:!0}),L=!0)},5e3)}),w.on("takeScreenshot",async()=>{try{return await chrome.tabs.captureVisibleTab()}catch{return Promise.resolve("")}})}tt(E);zn();Be({hostMatch:E,extensionId:I,extensionName:Ue});rt({projectId:I,callbackExtId:chrome.runtime.id,hostMatch:E});et({projectId:I,hostMatch:E,cacheId:"app-2.2.0",features:at,defaultMemoConfig:st});pe(z);chrome.scripting.registerContentScripts([{id:`inject-${I}`,js:["injects/proxy.js"],css:["injects/style.css"],matches:E,runAt:"document_start",world:"MAIN"}]);chrome.scripting.registerContentScripts([{id:`inject-${I}-module`,js:["injects/vendors.js","injects/index.js","injects/screenshot.js"],matches:E,runAt:"document_end",world:"MAIN"}]);
